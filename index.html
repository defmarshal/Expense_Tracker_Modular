<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>Penny - Smart Expense Tracking</title>
    <link rel="stylesheet" href="https:cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https:cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script src="https:cdnjs.cloudflare.com/ajax/libs/PapaParse/5.4.1/papaparse.min.js"></script>
    
    <link rel="stylesheet" href="css/variables.css">
    <link rel="stylesheet" href="css/base.css">
    <link rel="stylesheet" href="css/components.css">
    <link rel="stylesheet" href="css/layout.css">
    <link rel="stylesheet" href="css/pages/landing.css">
    <link rel="stylesheet" href="css/pages/dashboard.css">
    <link rel="stylesheet" href="css/utilities.css">
    <link rel="stylesheet" href="css/fab.css">
    <link rel="stylesheet" href="css/sidebar.css">
    <link rel="stylesheet" href="css/reimbursement.css">
    <link rel="stylesheet" href="css/receipt.css">
    <link rel="stylesheet" href="css/settings.css">
    <link rel="icon" href="data:image/svg+xml,<svg xmlns='http:www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>ðŸ’°</text></svg>">
</head>

<body>
    <header>
        <div class="logo">
            <svg xmlns="http:www.w3.org/2000/svg" xml:space="preserve" viewBox="0 0 2000 2193" width="32" height="35">
                <path fill="#a0c4dc" d="M1927 649c4.4 33.4 8.9 66 12.5 98.5a560 560 0 0 1 2.7 49.8c1 45.5 2 91.1 2 136.7-.2 28.5-2.3 57-3.9 85.5-1.3 22.5-2.5 45-4.7 67.5-4 38.9-8 77.8-13.3 116.5a1980 1980 0 0 1-18.6 116 2376 2376 0 0 1-27.4 118.2c-12.8 51.2-30 101.2-49.3 150.3a1054 1054 0 0 1-87.7 174.4 842 842 0 0 1-92.6 122.2 618 618 0 0 1-111.9 95.8A614 614 0 0 1 1421 2040a798 798 0 0 1-160.2 44.3c-37 6.5-74.3 10.6-111.7 13.7-15.2 1.2-30.5 1.1-45.8 2.3-9.8.8-19.9 1.9-29.4 4.4a558 558 0 0 1-123.8 19.4c-14 .5-27.9 1.4-41.8 1.1q-59.6-1.1-117.7-13.2a736 736 0 0 1-146.7-47.3 934 934 0 0 1-204.6-124.8 1082 1082 0 0 1-153.5-149.2c-4-4.6-8.1-7-13.8-8.8-24.5-7.4-42-22.5-48.6-48-1.5-5.7-2-11.9-1.5-17.7.5-5.5-1.2-9.5-4-13.8-14-22.2-28.4-44.2-41.8-66.7a850 850 0 0 1-68.6-147.1 807 807 0 0 1-43.6-189.7c-2.3-20.8-3.1-41.7-4.2-62.6-.8-16.6-1.8-33.2-1.2-49.8a1073 1073 0 0 1 8.6-108A1104 1104 0 0 1 108.6 893a1402 1402 0 0 1 64.2-167.4q32.3-70.7 70.6-138.6c27.4-48.7 56.1-96.6 87-143.2a1471 1471 0 0 1 116.5-155.2 1190 1190 0 0 1 67-71.2c44.3-43 92.3-81.3 146.3-111.5a443 443 0 0 1 173-56.8q64.5-6.4 127.7 8.3h1.4c6.8-5.4 13-11 19.8-15.5a50 50 0 0 1 27.5-7.8c37.6-.3 75.3-1 112.8 0a1185 1185 0 0 1 265 36.6 917 917 0 0 1 199 75.3c49.3 26 95.2 57 137 94.1q58.6 52 100.7 117.8c25.5 40 45.3 82.7 61.4 127.2a966 966 0 0 1 40 154.1c.6 3 .8 6 1.5 9.8m-726.7 974.4c-2 29.8-3.6 59.6-6 89.3q-3.5 44.1-9 88.1a77 77 0 0 1-8.4 27.2c-15.1 27.3-47 37.2-73.6 32.3-29.2-5.4-45-25.9-42.8-55.4 2-25 5.4-50 7.9-75.1 2.6-27 6-54 7-81.2 1-25.8 2.3-51.7 1.3-77.6-1.2-28.6-2.7-57-6.6-85.3a494 494 0 0 0-60.5-179.2 499 499 0 0 1-42.7-91c-9.8-29.7-13.5-60-7-91 6.3-31 20.7-58.1 39.2-83.3 15.2-20.7 33.6-38.5 51.4-56.9a867 867 0 0 0 41.6-45.6c31.6-37.6 41.6-81.6 35.2-129.5-3.5-26.1-11-51.2-20.6-75.8a1338 1338 0 0 0-57.2-125c-15.6-30.5-33.7-59.5-58.7-83.7a176 176 0 0 0-75.7-44.4c-31-8.7-61.6-7.3-89.9 8.8-49.6 28-68.7 74-70.4 128.1-.7 21.1 4 42.2 12.1 62.1a50.7 50.7 0 0 1-29.6 68q-7.3 2.8-14.8 5 4 7.6 7.4 14.7c9.5 21.9 8 43-6 62.4a619 619 0 0 1-31.2 38.8c-7.8 9-16.2 17.5-25.2 27 7.8 8.2 15 16.5 22.9 24 22.4 21.4 30.5 48.7 31 78.4.2 12.8-2.9 25.6-4.4 38.5-1.4 11.4-4.7 22.8-.8 34.4 3.1 9.6 8.3 13.8 18.4 13.3 5.6-.2 11.1-1.7 16.6-3a56 56 0 0 1 43.3 6c26.8 16.3 38.6 57.1 21.5 87.3a66 66 0 0 0-7.6 26.1 292 292 0 0 1-45.3 125.4c-29.4 45.6-68.3 82-111.8 113.9-37.5 27.5-75.7 54-112.8 82.2A754 754 0 0 0 398.2 1657c-11 14-21 28.9-31.6 43.4q3.3 4.8 5.8 8 45.9 57 100.3 105.4a776 776 0 0 0 189.1 125c62.3 28.8 127 49.3 195.5 56.5 16.1 1.6 32.3 2.3 47.6 3.3a57 57 0 0 1 48.7-21.6c28.7.7 57.3.5 86 1q12.5.2 24.3-3.9a483 483 0 0 0 216.3-144.5 651 651 0 0 0 90-136c24-47.4 43.3-96.9 59.2-147.7a1593 1593 0 0 0 46.2-189.4c9.7-52.8 18-106 26.7-158.9q14.9-89.3 21.7-179.5c2-28.8 3.7-57.7 4.1-86.6.4-29.2-.8-58.5-1.9-87.8-.6-16.2-2.4-32.3-3.8-48.5-4.6-49-14.3-97-28.2-144.3a643 643 0 0 0-82.7-177.2 688 688 0 0 0-137.1-150.5 719 719 0 0 0-190-111.7c-4.8-2-8.5-1.8-13.1.3a59 59 0 0 1-52.9-1.8 531 531 0 0 0-25.2-12 286 286 0 0 0-192.7-16.9c-52 13.2-98.4 38.1-141.5 69.6a681 681 0 0 0-97.7 87.9 888 888 0 0 0-61.5 73.1c-38.5 51.8-73 106.4-106.8 161.2-43 69.7-82.5 141.2-116.8 215.6-28.4 61.6-52.5 124.9-71.1 190.2a706 706 0 0 0-23.6 265.2q5.8 60.6 20 119.6a887 887 0 0 0 72.6 193.7q7.9 14.9 16 29.6 1.4-.5 1.5-.7l6.8-8.6a682 682 0 0 1 88.7-99.5c15.3-13.8 30.3-28.2 47-40 30.3-21.6 61.6-41.7 92.8-62.1 36-23.5 71.5-47.3 101.7-78.4 17.4-17.8 32-37.3 42.4-59.8a112 112 0 0 0 11.8-38.5c-7.7-4-15-7.1-21.9-11.1-45.4-26.6-70.7-65.3-70.5-118.8q-.2-23.5 1.8-46.8a56 56 0 0 0-14.8-46.7c-9-9.6-16.3-21-23-32.5a96 96 0 0 1-9-81.4 153 153 0 0 1 28.9-50.9c16-19 33-37.2 49.5-56 9.2-10.4 18.3-21 32-26.6-2.8-5.1-5.7-9.5-7.7-14.3a270 270 0 0 1-19.6-83c-2-22.6-.6-45 3.2-67.5a254 254 0 0 1 83-152c57.6-50.9 126.5-68.9 202-61.1 55.8 5.8 103 31.4 144 69.2 33.4 31 60.3 67.3 83.7 106.2a898 898 0 0 1 49 94.8c17.4 38.7 33.7 78 45.4 119 7.5 26.2 12.9 52.8 14.6 80 1 16.2 0 32.6-1.2 48.8-3.3 44-17.8 83.9-47.7 117-20.8 22.9-42.8 44.7-64 67.1-14.5 15.2-28.1 31-39.1 49a101 101 0 0 0-9.7 90.8 427 427 0 0 0 22.1 50.1c11.3 21.9 24.5 42.7 35.6 64.7a447 447 0 0 1 36.3 109.3c9.7 45.2 14 91 15.7 137.2.9 22.5-.6 45.2-1 69.7m422.9-385.3-11 68.8q-13.5 83-33.6 164.7c-5 20.6-10.5 41-16 62.5l62 3q25.3 1 50.7 2.2a72 72 0 0 1 32.8 10.3c1.1-1.8 2-2.8 2.4-4 6.6-17.4 13.5-34.7 19.5-52.3 24.7-71.7 43.2-145 56.5-219.7a2022 2022 0 0 0 21.3-151.5q4.5-45.5 8-91.1c1.2-14.9 1.7-29.8 2.4-44.8 1.2-25.2 3-50.3 3.2-75.5.3-29.3-.7-58.6-1.2-87.9q-.1-2-1-5.2c-59.4 4.3-117.8-1.3-177.2-9.4q1 7.1 1.5 13.8c2 30 5.2 60.2 5.8 90.3.6 34-.4 68-1.7 101.8-1 24.8-3.2 49.6-5.5 74.4-2 20.7-4.8 41.4-7.4 62.1-3.6 28.6-7.5 57.2-11.5 87.5m-82.4-772.1 17.7 35a636 636 0 0 1 197-7 464 464 0 0 0-50.8-90.1l-186.1 21.2zm-154.6-267.3c-34.6-9.6-69.4-18-105.2-23.3a821 821 0 0 1 156.3 138c7.7-2.2 14-4.8 20.4-5.6 28-3.6 56-6.6 84-9.8l48.7-5.7-14.9-9.8a626 626 0 0 0-82.3-44.6 802 802 0 0 0-107-39.2m361.6 418.4c-18.5-1.3-37-3.5-55.6-3.7-19.5-.3-39.1 1.1-58.7 2.3-9.7.6-19.4 2.3-29.3 3.6l19.7 77.5a84 84 0 0 1 56.6-8c9.5 1.7 19.1 2.4 28.7 3.1q20.4 1.6 40.8 2 28.7.4 57.4.2c.7-15.5-11.7-81-17.2-91.8-11.7 10-24.5 17.2-42.4 14.8m-138.9 1109c3.3 3.7 5 .9 6.6-1.8q16.3-25.6 32.4-51.4c1.9-3 3.4-6.2 5.7-10.4l-132.1-5.9-22 54.5h70c14.5 0 27.5 4 39.4 15m-161.3 109c-1.3-.2-2.8 0-4-.5-7.1-3-11.3-.3-15.3 6.1a687 687 0 0 1-58.5 78.1q-4 4.7-8.2 9.2c58.3-20.4 110-51 155.5-93z"/>
                <path fill="none" d="M1623.5 1237.4c3.8-29.5 7.7-58 11.3-86.7 2.6-20.7 5.4-41.4 7.4-62.1 2.3-24.8 4.5-49.6 5.5-74.4 1.3-33.9 2.3-67.8 1.7-101.8-.6-30.1-3.7-60.2-5.8-90.3q-.6-6.7-1.5-13.8c59.4 8.1 117.8 13.7 177.3 9.4q.8 3.1.9 5.2c.5 29.3 1.5 58.6 1.2 87.9-.3 25.2-2 50.3-3.2 75.5-.7 15-1.2 30-2.4 44.8a4359 4359 0 0 1-8 91.1 2022 2022 0 0 1-21.3 151.5c-13.3 74.7-31.8 148-56.5 219.7-6 17.6-12.9 34.9-19.5 52.3-.4 1.2-1.3 2.2-2.4 4a72 72 0 0 0-32.8-10.3q-25.3-1.2-50.8-2.2l-62-3c5.6-21.5 11-42 16.1-62.5a2079 2079 0 0 0 33.6-164.7z"/>
                <path fill="none" d="m1540.6 465.4-22-40.2c62.4-7 123.9-14.1 186.2-21.2a464 464 0 0 1 50.7 90 636 636 0 0 0-196.9 7.1z"/>
                <path fill="none" d="M1387 199.1c37 10.5 72 23.5 106.3 39a626 626 0 0 1 82.3 44.5l14.9 9.8-48.8 5.7c-28 3.2-56 6.2-84 9.8-6.4.8-12.6 3.4-20.3 5.6a821 821 0 0 0-156.3-138 831 831 0 0 1 106 23.6"/>
                <path fill="none" d="M1748.8 617.4c17 2.2 29.8-5 41.5-15 5.5 10.8 18 76.3 17.2 91.8q-28.6.2-57.4-.1-20.4-.5-40.8-2c-9.6-.8-19.2-1.5-28.7-3.2a84 84 0 0 0-56.6 8l-19.7-77.5c9.9-1.3 19.6-3 29.3-3.6 19.6-1.2 39.2-2.6 58.7-2.3 18.6.2 37 2.4 56.5 3.9"/>
                <path fill="none" d="M1608.5 1725.6a55 55 0 0 0-39-14.4h-70c7.6-18.5 14.6-36 22-54.5l132.2 5.9c-2.3 4.2-3.8 7.4-5.7 10.4q-16.1 25.8-32.4 51.4c-1.7 2.7-3.3 5.5-7.1 1.2"/>
                <path fill="none" d="M1448.6 1835.2h68.7a441 441 0 0 1-155.6 92.9q4.2-4.5 8.2-9.2c21-24.9 41.2-50.4 58.5-78 4-6.5 8.2-9.1 15.3-6.2 1.2.5 2.7.3 5 .5"/>
            </svg>
            <span class="logo-font">Penny</span>
        </div>
        
        <div class="nav-links" id="navLinks">
            <a href="index.html" class="nav-link active">
                <i class="fas fa-home"></i>
                <span>Dashboard</span>
            </a>
            <a href="analytics.html" class="nav-link">
                <i class="fas fa-chart-bar"></i>
                <span>Analytics</span>
            </a>
        </div>

        <div class="header-buttons" style="display: flex; align-items: center; gap: 12px;">
            <button id="searchBtn" class="icon-btn" style="display: none;" title="Search">
                <i class="fas fa-search"></i>
            </button>
            
            <button id="loginBtn" class="btn btn-outline">
                <i class="fas fa-sign-in-alt"></i>
            </button>
            <button id="signupBtn" class="btn btn-primary">
                <i class="fas fa-user-plus"></i>
            </button>
            <button id="logoutBtn" class="btn btn-outline hidden">
                <i class="fas fa-sign-out-alt"></i>
            </button>
        </div>        
    </header>

    <div id="landingPage" class="landing-page" style="display: none;">
        <section class="hero">
            <div class="hero-content">
                <h1>
                    Track Every Dollar.<br>Stay in Control.
                </h1>
                <p>
                    Simple expense tracking with budgets, receipts, and reimbursements.
                </p>
                <div class="hero-buttons">
                    <button id="heroSignupBtn" class="btn btn-primary">
                        <i class="fas fa-rocket"></i>
                        Get Started Free
                    </button>
                </div>
                
                <div>
                    <div>
                        <div>
                            <i class="fas fa-wallet"></i>
                        </div>
                        <h3>Multi-Wallet</h3>
                        <p>Track multiple accounts</p>
                    </div>
                    <div>
                        <div>
                            <i class="fas fa-chart-line"></i>
                        </div>
                        <h3>Smart Budgets</h3>
                        <p>Set limits, stay aware</p>
                    </div>
                    <div>
                        <div>
                            <i class="fas fa-receipt"></i>
                        </div>
                        <h3>Receipts</h3>
                        <p>Upload and organize</p>
                    </div>
                    <div>
                        <div>
                            <i class="fas fa-exchange-alt"></i>
                        </div>
                        <h3>Reimbursements</h3>
                        <p>Track pending paybacks</p>
                    </div>
                </div>
            </div>
        </section>

        <footer>
            <div>
                <p>&copy; 2024 Penny. Simple expense tracking.</p>
            </div>
        </footer>
    </div>

    <div id="dashboardContainer" class="dashboard-container" style="display: none;">
        
        <aside class="sidebar">
            <nav class="sidebar-nav">
                <a href="#" class="sidebar-nav-item active" data-tab="overview">
                    <i class="fas fa-home"></i>
                    <span>Overview</span>
                </a>
                <a href="#" class="sidebar-nav-item" data-tab="expenses">
                    <i class="fas fa-shopping-cart"></i>
                    <span>Expenses</span>
                </a>
                <a href="#" class="sidebar-nav-item" data-tab="income">
                    <i class="fas fa-coins"></i>
                    <span>Income</span>
                </a>
                <a href="#" class="sidebar-nav-item" data-tab="budget">
                    <i class="fas fa-chart-line"></i>
                    <span>Budget</span>
                </a>
                <a href="#" class="sidebar-nav-item" data-tab="more">
                    <i class="fas fa-cog"></i>
                    <span>Settings</span>
                </a>
            </nav>
        </aside>
        
        <div class="dashboard-with-sidebar">
            <div class="container">    
                <div class="dashboard-header">
                    <h1 class="dashboard-title">Dashboard</h1>
                    <div class="wallet-selector-container">
                        <label for="globalWalletSelect">Wallet:</label>
                        <select id="globalWalletSelect">
                            <option value="">Select wallet</option>
                        </select>
                        <span id="userEmail"></span>
                    </div>
                </div>

                <div class="dashboard-stats">
                    <div class="stat-card">
                        <div class="stat-label">Income</div>
                        <div class="stat-value income" id="totalIncome">Rp 0</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-label">Expenses</div>
                        <div class="stat-value expense" id="totalExpenses">Rp 0</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-label">Balance</div>
                        <div class="stat-value balance" id="currentWalletBalance">Rp 0</div>
                    </div>
                </div>

                <div id="overviewTab" class="tab-content active">
                    <div class="budget-overview-compact">
                        <h2 class="form-title">Budget Status</h2>
                        <div id="budgetOverviewList">
                            <div class="budget-overview-item">
                                <div class="budget-details">No budgets set</div>
                            </div>
                        </div>
                    </div>

                    <div class="expense-list">
                        <h2 class="form-title" style="display: flex; align-items: center; justify-content: space-between; cursor: pointer;" onclick="toggleRecentActivity()">
                            <span>Recent Activity</span>
                            <i class="fas fa-chevron-down" id="recentActivityChevron" style="transition: transform 0.3s ease;"></i>
                        </h2>
                        <div id="recentActivityContainer" style="display: none; transition: all 0.3s ease;">
                            <div id="recentActivityList">
                                <div class="expense-item">
                                    <div class="expense-details">No transactions yet</div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <div id="budgetTab" class="tab-content">
                    <div class="budget-management">
                        <h2 class="form-title" style="margin-bottom: 1.5rem;">Category Budgets</h2>
                        
                        <div id="budgetCategoriesList">
                            <div class="budget-item">
                                <div class="budget-details">Loading categories...</div>
                            </div>
                        </div>
                    </div>
                </div>               

                <div id="expensesTab" class="tab-content">
                    <div class="expense-sub-tabs">
                        <button class="expense-sub-tab active" data-subtab="all">
                            <i class="fas fa-list"></i>
                            All Expenses
                        </button>
                        <button class="expense-sub-tab" data-subtab="reimbursement">
                            <i class="fas fa-exchange-alt"></i>
                            Reimbursements
                        </button>
                    </div>

                    <div id="allExpensesView" class="expense-sub-view">
                        <div class="month-filter">
                            <label for="expenseMonthSelect">Month:</label>
                            <select id="expenseMonthSelect"></select>
                            <label for="expenseYearSelect">Year:</label>
                            <select id="expenseYearSelect"></select>
                        </div>
                        
                        <div class="expense-summary">
                            <h3>Total for <span id="expenseSelectedMonthYear">this month</span></h3>
                            <div class="expense-summary-amount" id="expenseMonthlyTotal">Rp 0</div>
                        </div>
                        
                        <div class="expense-list">
                            <div id="expensesByDayList">
                                <div class="expense-item">
                                    <div class="expense-details">Select a month</div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div id="reimbursementView" class="expense-sub-view" style="display: none;">
                        <div class="reimbursement-dashboard">
                            <div class="reimbursement-stat-card pending">
                                <div class="reimbursement-stat-label">
                                    <i class="fas fa-clock"></i>
                                    Pending
                                </div>
                                <div class="reimbursement-stat-value" id="reimbPendingTotal">Rp 0</div>
                                <div class="reimbursement-stat-count" id="reimbPendingCount">0 expenses</div>
                            </div>
                            
                            <div class="reimbursement-stat-card reimbursed">
                                <div class="reimbursement-stat-label">
                                    <i class="fas fa-check-circle"></i>
                                    Reimbursed
                                </div>
                                <div class="reimbursement-stat-value" id="reimbReimbursedTotal">Rp 0</div>
                                <div class="reimbursement-stat-count" id="reimbReimbursedCount">0 expenses</div>
                            </div>
                        </div>

                        <div class="reimbursement-section">
                            <div class="reimbursement-section-header">
                                <div class="reimbursement-section-title pending">
                                    <i class="fas fa-clock"></i>
                                    <span>Pending Reimbursement</span>
                                </div>
                                <span class="reimbursement-section-count" id="pendingReimbursementCount">0</span>
                            </div>
                            <div id="pendingReimbursementList">
                            </div>
                        </div>

                        <div class="reimbursement-section">
                            <div class="reimbursement-section-header">
                                <div class="reimbursement-section-title reimbursed">
                                    <i class="fas fa-check-circle"></i>
                                    <span>Reimbursed</span>
                                </div>
                                <span class="reimbursement-section-count" id="reimbursedCount">0</span>
                            </div>
                            <div id="reimbursedList">
                            </div>
                        </div>
                    </div>
                </div>

                <div id="incomeTab" class="tab-content">
                    <div class="month-filter">
                        <label for="incomeMonthSelect">Month:</label>
                        <select id="incomeMonthSelect"></select>
                        <label for="incomeYearSelect">Year:</label>
                        <select id="incomeYearSelect"></select>
                    </div>
                    
                    <div class="expense-summary">
                        <h3>Total for <span id="incomeSelectedMonthYear">this month</span></h3>
                        <div class="expense-summary-amount" style="color: var(--success);" id="incomeMonthlyTotal">Rp 0</div>
                    </div>
                    
                    <div class="income-list">
                        <div id="incomesByDayList">
                            <div class="income-item">
                                <div class="income-details">Select a month</div>
                            </div>
                        </div>
                    </div>
                </div>

                <div id="moreTab" class="tab-content">
                    <div class="settings-section">
                        <h2 class="settings-section-title">
                            <i class="fas fa-database"></i>
                            Data Management
                        </h2>
                        
                        <div class="settings-card" onclick="window.finTrack.ui.openExportModal()" style="cursor: pointer;">
                            <div class="settings-card-icon">
                                <i class="fas fa-download"></i>
                            </div>
                            <div class="settings-card-content">
                                <div class="settings-card-title">Export Data</div>
                                <div class="settings-card-description">Download transactions, budgets, and reports</div>
                            </div>
                            <div class="settings-card-arrow">
                                <i class="fas fa-chevron-right"></i>
                            </div>
                        </div>
                    </div>

                    <div class="settings-section">
                        <h2 class="settings-section-title">
                            <i class="fas fa-wallet"></i>
                            Account Setup
                        </h2>
                        
                        <div class="settings-card expandable">
                            <div class="settings-card-header" onclick="toggleSettingsSection('wallets')">
                                <div style="display: flex; align-items: center; gap: 12px; flex: 1;">
                                    <div class="settings-card-icon">
                                        <i class="fas fa-wallet"></i>
                                    </div>
                                    <div class="settings-card-content">
                                        <div class="settings-card-title">My Wallets</div>
                                        <div class="settings-card-description" id="walletsCount">Loading...</div>
                                    </div>
                                </div>
                                <div class="settings-card-arrow">
                                    <i class="fas fa-chevron-down" id="walletsChevron"></i>
                                </div>
                            </div>
                            <div class="settings-card-body" id="walletsBody" style="display: none;">
                                <div id="walletsList">
                                    <div class="wallet-item">
                                        <div class="wallet-details">No wallets yet</div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="settings-card expandable">
                            <div class="settings-card-header" onclick="toggleSettingsSection('categories')">
                                <div style="display: flex; align-items: center; gap: 12px; flex: 1;">
                                    <div class="settings-card-icon">
                                        <i class="fas fa-tags"></i>
                                    </div>
                                    <div class="settings-card-content">
                                        <div class="settings-card-title">Categories</div>
                                        <div class="settings-card-description" id="categoriesCount">Loading...</div>
                                    </div>
                                </div>
                                <div class="settings-card-arrow">
                                    <i class="fas fa-chevron-down" id="categoriesChevron"></i>
                                </div>
                            </div>
                            <div class="settings-card-body" id="categoriesBody" style="display: none;">
                                <div id="categoriesList">
                                    <div class="category-item">
                                        <div class="category-details">No categories yet</div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="settings-section">
                        <h2 class="settings-section-title">
                            <i class="fas fa-user"></i>
                            Profile
                        </h2>
                        
                        <div class="settings-card">
                            <div class="settings-card-icon">
                                <i class="fas fa-envelope"></i>
                            </div>
                            <div class="settings-card-content">
                                <div class="settings-card-title">Email</div>
                                <div class="settings-card-description" id="userEmailSettings">Loading...</div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <nav class="bottom-nav">
            <div class="bottom-nav-items">
                <a href="#" class="bottom-nav-item active" data-tab="overview">
                    <i class="fas fa-home"></i>
                    <span>Overview</span>
                </a>
                <a href="#" class="bottom-nav-item" data-tab="expenses">
                    <i class="fas fa-shopping-cart"></i>
                    <span>Expenses</span>
                </a>
                <a href="#" class="bottom-nav-item" data-tab="income">
                    <i class="fas fa-coins"></i>
                    <span>Income</span>
                </a>
                <a href="#" class="bottom-nav-item" data-tab="budget">
                    <i class="fas fa-chart-line"></i>
                    <span>Budget</span>
                </a>
                <a href="#" class="bottom-nav-item" data-tab="more">
                    <i class="fas fa-cog"></i>
                    <span>Settings</span>
                </a>
            </div>
        </nav>
        
    </div>

    <div class="modal-overlay" id="subcategoryModal">
        <div class="modal">
            <div class="modal-header">
                <div style="position: absolute; top: -50px; right: -50px; width: 150px; height: 150px; background: rgba(255,255,255,0.1); border-radius: 50%; animation: float 3s ease-in-out infinite;"></div>  
                <button class="modal-close" id="closeSubcategoryModal">
                    <i class="fas fa-times"></i>
                </button>
                <div style="display: flex; align-items: center; justify-content: center; gap: 12px; margin-bottom: 8px;">
                    <div style="width: 48px; height: 48px; background: rgba(255,255,255,0.2); border-radius: 12px; display: flex; align-items: center; justify-content: center; backdrop-filter: blur(10px); box-shadow: 0 4px 12px rgba(0,0,0,0.1);">
                        <i class="fa fa-plus-square" style="font-size: 1.3rem; color: white;"></i>
                    </div>
                    <h2 class="modal-title" style="margin: 0; color: white;">Add Subcategory</h2>
                </div>                
                <!-- <h2 class="modal-title">Add Subcategory</h2> -->
                <!-- <p class="modal-subtitle">Quick add</p> -->
            </div>
            <div class="modal-body">
                <form id="subcategoryForm">
                    <div class="form-group">
                        <label for="subcategoryName">Name</label>
                        <input type="text" id="subcategoryName" placeholder="e.g., Groceries" required>
                    </div>
                    <input type="hidden" id="parentCategoryId">
                    <button type="submit" class="btn btn-primary" style="width: 100%; padding: 12px;">
                        <i class="fas fa-plus"></i> Add
                    </button>
                </form>
            </div>
        </div>
    </div>

    <div class="modal-overlay" id="deleteModal">
        <div class="modal">
            <div class="modal-header" style="background: linear-gradient(135deg, #EF4444 0%, #DC2626 100%); padding:1.5rem">
                <div style="position: absolute; top: -50px; right: -50px; width: 150px; height: 150px; background: rgba(255,255,255,0.1); border-radius: 50%; animation: float 3s ease-in-out infinite;"></div>                
                <button class="modal-close" id="closeDeleteModal">
                    <i class="fas fa-times"></i>
                </button>
                <div style="display: flex; align-items: center; justify-content: center; gap: 12px; margin-bottom: 8px;">
                    <div style="width: 48px; height: 48px; background: rgba(255,255,255,0.2); border-radius: 12px; display: flex; align-items: center; justify-content: center; backdrop-filter: blur(10px); box-shadow: 0 4px 12px rgba(0,0,0,0.1);">
                        <i class="fa fa-trash" style="font-size: 1.3rem; color: white;"></i>
                    </div>                
                    <h2 class="modal-title" style="color:white">Delete?</h2>
                </div>
            </div>
            <div class="modal-body">
                <p id="deleteMessage" style="margin-bottom: 1.5rem; font-size: 0.95rem;"></p>
                <div style="display: flex; gap: 10px;">
                    <button class="btn btn-outline" id="cancelDeleteBtn" style="flex: 1;">
                        <i class="fas fa-times"></i> Cancel
                    </button>
                    <button class="btn" id="confirmDeleteBtn" style="flex: 1; background: #EF4444; color: white;">
                        <i class="fas fa-trash"></i> Delete
                    </button>
                </div>
            </div>
        </div>
    </div>

    <div class="modal-overlay insufficient-balance-modal" id="insufficientBalanceModal">
        <div class="modal">
            <div class="modal-header">
                <button class="modal-close" id="closeInsufficientBalanceModal">
                    <i class="fas fa-times"></i>
                </button>
                <h2 class="modal-title">Not Enough Balance</h2>
                <p class="modal-subtitle">Need more funds</p>
            </div>
            <div class="modal-body">
                <div class="balance-warning">
                    <i class="fas fa-exclamation-triangle"></i>
                    <div>
                        <h3 style="font-size: 0.95rem; margin-bottom: 0.3rem;">Insufficient funds</h3>
                        <p style="font-size: 0.85rem; opacity: 0.9;">Add income to proceed</p>
                    </div>
                </div>
                <div class="balance-details">
                    <div class="balance-item">
                        <span>Expense:</span>
                        <strong id="expenseAmountDetail">Rp 0</strong>
                    </div>
                    <div class="balance-item">
                        <span>Balance:</span>
                        <strong id="walletBalanceDetail">Rp 0</strong>
                    </div>
                    <div class="balance-item">
                        <span>After:</span>
                        <strong id="remainingBalanceDetail" style="color: var(--danger);">Rp 0</strong>
                    </div>
                </div>
                <div style="display: flex; gap: 10px;">
                    <button class="btn btn-success" id="addFundsBtn" style="flex: 1;">
                        <i class="fas fa-plus"></i> Add Income
                    </button>
                    <button class="btn btn-outline" id="cancelExpenseBtn" style="flex: 1;">
                        <i class="fas fa-times"></i> Cancel
                    </button>
                </div>
            </div>
        </div>
    </div>

    <div class="modal-overlay" id="signupModal">
        <div class="modal">
            <div class="modal-header">
                <button class="modal-close" id="closeSignupModal">
                    <i class="fas fa-times"></i>
                </button>
                <h2 class="modal-title">Join Penny</h2>
                <p class="modal-subtitle">Start tracking today</p>
            </div>
            <div class="modal-body">
                <form id="signupForm">
                    <div class="form-group">
                        <label for="signupEmail">Email</label>
                        <input type="email" id="signupEmail" placeholder="your@email.com" required autocomplete="email">
                    </div>
                    <div class="form-group">
                        <label for="signupPassword">Password</label>
                        <input type="password" id="signupPassword" placeholder="Create password" required autocomplete="new-password">
                        <div class="password-strength">
                            <div class="strength-bar" id="passwordStrength"></div>
                        </div>
                    </div>
                    <div class="form-group">
                        <label for="confirmPassword">Confirm Password</label>
                        <input type="password" id="confirmPassword" placeholder="Confirm password" required autocomplete="new-password">
                    </div>
                    <button type="submit" class="btn btn-primary" style="width: 100%; padding: 12px;">
                        <i class="fas fa-user-plus"></i> Create Account
                    </button>
                </form>
                <div style="text-align: center; margin-top: 1.2rem;">
                    <p style="font-size: 0.9rem;">Already have an account? <a href="#" id="showLoginFromSignup" style="color: var(--primary); text-decoration: none; font-weight: 600;">Sign in</a></p>
                </div>
            </div>
        </div>
    </div>

    <div class="modal-overlay" id="loginModal">
        <div class="modal">
            <div class="modal-header">
                <button class="modal-close" id="closeLoginModal">
                    <i class="fas fa-times"></i>
                </button>
                <h2 class="modal-title">Welcome Back</h2>
                <p class="modal-subtitle">Sign in to continue</p>
            </div>
            <div class="modal-body">
                <form id="loginForm">
                    <div class="form-group">
                        <label for="loginEmail">Email</label>
                        <input type="email" id="loginEmail" placeholder="your@email.com" required autocomplete="email">
                    </div>
                    <div class="form-group">
                        <label for="loginPassword">Password</label>
                        <input type="password" id="loginPassword" placeholder="Enter password" required autocomplete="current-password">
                    </div>
                    <button type="submit" class="btn btn-primary" style="width: 100%; padding: 12px;">
                        <i class="fas fa-sign-in-alt"></i> Sign In
                    </button>
                </form>
                <div style="text-align: center; margin-top: 1.2rem;">
                    <p style="font-size: 0.9rem;">Don't have an account? <a href="#" id="showSignupFromLogin" style="color: var(--primary); text-decoration: none; font-weight: 600;">Join now</a></p>
                </div>
            </div>
        </div>
    </div>

    <div id="alertContainer" style="position: fixed; top: 80px; right: 12px; z-index: 3000; max-width: 350px;"></div>

    <div id="editTransactionModal" class="modal-overlay">
        <div class="modal">
            <div class="modal-header">
                <div style="position: absolute; top: -50px; right: -50px; width: 150px; height: 150px; background: rgba(255,255,255,0.1); border-radius: 50%; animation: float 3s ease-in-out infinite;"></div>
                <button class="modal-close" onclick="document.getElementById('editTransactionModal').classList.remove('active')">
                    <i class="fas fa-times"></i>
                </button>
                <div style="display: flex; align-items: center; justify-content: center; gap: 12px; margin-bottom: 8px;">
                    <div style="width: 48px; height: 48px; background: rgba(255,255,255,0.2); border-radius: 12px; display: flex; align-items: center; justify-content: center; backdrop-filter: blur(10px); box-shadow: 0 4px 12px rgba(0,0,0,0.1);">
                        <i class="fas fa-edit" style="font-size: 1.3rem; color: white;"></i>
                    </div>
                    <h2 class="modal-title" id="editModalTitle" style="margin: 0; color: white;">Edit Transaction</h2>
                </div>
                <p class="modal-subtitle" id="editModalSubtitle">Make changes and save</p>
            </div>

            <div class="modal-body" style="padding: 1.25rem;">
            <form id="editTransactionForm" class="compact-form">
                <input type="hidden" id="editItemId">
                <input type="hidden" id="editItemType">
                
                <div class="form-group" style="margin-bottom: 0.8rem;">
                    <label for="editDescription" style="font-size: 0.85rem; margin-bottom: 0.3rem;">Description</label>
                    <input type="text" id="editDescription" placeholder="What was this for?" style="padding: 10px 12px; font-size: 0.95rem;">
                </div>
                
                <div class="form-row" id="editExpenseCategoryRow" style="gap: 0.8rem; margin-bottom: 0.8rem;">
                    <div class="form-group" style="margin-bottom: 0;">
                        <label for="editCategory" style="font-size: 0.85rem; margin-bottom: 0.3rem;">Category</label>
                        <select id="editCategory" required style="padding: 10px 12px; font-size: 0.95rem;">
                            <option value="">Select category</option>
                        </select>
                    </div>
                    <div class="form-group" style="margin-bottom: 0;">
                        <label for="editSubcategory" style="font-size: 0.85rem; margin-bottom: 0.3rem;">Subcategory</label>
                        <select id="editSubcategory" style="padding: 10px 12px; font-size: 0.95rem;">
                            <option value="">Optional</option>
                        </select>
                    </div>
                </div>

                <div id="editIncomeReimbursementSection" style="display: none; margin-bottom: 1rem;">
                    <div class="reimbursement-toggle">
                        <label>
                            <input type="checkbox" id="editIncomeIsReimbursement">
                            <span>ðŸ”— This is a reimbursement</span>
                        </label>
                        <div class="toggle-hint">
                            Check this if you're being reimbursed for expenses you've already paid
                        </div>
                    </div>
                    
                    <div id="editIncomeExpenseSelector" class="hidden" style="margin-top: 1rem;">
                        <button type="button" class="btn btn-secondary" id="editSelectExpensesBtn" style="width: 100%;">
                            <i class="fas fa-list"></i>
                            <span id="editSelectedExpensesText">Select Expenses to Reimburse</span>
                        </button>
                    </div>
                </div>

                <div class="form-row" style="gap: 0.8rem; margin-bottom: 0.8rem;">
                    <div class="form-group" style="margin-bottom: 0;">
                        <label for="editAmount" style="font-size: 0.85rem; margin-bottom: 0.3rem;">Amount</label>
                        <div class="currency-input">
                            <span class="currency-symbol">Rp</span>
                            <input type="text" id="editAmount" placeholder="0" style="padding: 10px 12px 10px 38px; font-size: 0.95rem;">
                        </div>
                    </div>
                    <div class="form-group" style="margin-bottom: 0;">
                        <label for="editDate" style="font-size: 0.85rem; margin-bottom: 0.3rem;">Date</label>
                        <input type="date" id="editDate" required style="padding: 10px 12px; font-size: 0.95rem;">
                    </div>
                </div>

                <div class="form-group" id="editExpenseReceiptSection" style="margin-bottom: 1rem; display: none;">
                    <label for="editReceiptUpload" style="font-size: 0.85rem; margin-bottom: 0.3rem;">Receipt (optional)</label>
                    <div style="display: flex; flex-direction: column; gap: 8px;">
                        <input type="file" 
                            id="editReceiptUpload" 
                            accept="image/*,.pdf" 
                            style="padding: 10px 12px; font-size: 0.95rem; border: 2px dashed var(--light-gray); border-radius: 8px; cursor: pointer;">
                        <div id="editReceiptPreview" style="display: none;">
                        </div>
                    </div>
                </div>                

                <div class="form-group" id="editExpenseReimbursableSection" style="margin-bottom: 1rem; display: none;">
                    <label class="checkbox-label">
                        <input type="checkbox" id="editIsReimbursable">
                        <span>ðŸ’° This expense will be reimbursed</span>
                    </label>
                </div>

                <div class="form-group" id="editIncomeTypeGroup" style="margin-bottom: 1rem; display: none;">
                    <label for="editIncomeType" style="font-size: 0.85rem; margin-bottom: 0.3rem;">Type</label>
                    <select id="editIncomeType" style="padding: 10px 12px; font-size: 0.95rem;">
                        <option value="">Select type</option>
                    </select>
                </div>

                    <div class="form-row" style="gap: 0.8rem; margin-top: 1rem;">
                        <button type="button" class="btn btn-outline" onclick="document.getElementById('editTransactionModal').classList.remove('active')" style="padding: 10px; font-size: 0.9rem; flex: 1;">
                            <i class="fas fa-times"></i> Cancel
                        </button>
                        <button type="submit" class="btn btn-primary" style="padding: 10px; font-size: 0.9rem; flex: 1;">
                            <i class="fas fa-save"></i> Save
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div> 

    <div class="fab-backdrop" id="fabBackdrop"></div>

    <div class="fab-container" id="fabContainer">
        <div class="fab-menu" id="fabMenu">
            <button class="fab-menu-item expense" data-action="expense">
                <i class="fas fa-shopping-cart"></i>
                <span>Add Expense</span>
            </button>
            <button class="fab-menu-item income" data-action="income">
                <i class="fas fa-coins"></i>
                <span>Add Income</span>
            </button>
            <button class="fab-menu-item wallet" data-action="wallet">
                <i class="fas fa-wallet"></i>
                <span>Add Wallet</span>
            </button>
            <button class="fab-menu-item category" data-action="category">
                <i class="fas fa-tags"></i>
                <span>Add Category</span>
            </button>
            <button class="fab-menu-item budget" data-action="budget">
                <i class="fas fa-chart-line"></i>
                <span>Set Budget</span>
            </button>            
        </div>
        <button class="fab-button" id="fabButton">
            <i class="fas fa-plus"></i>
        </button>
    </div>    

    <div class="modal-overlay" id="fabQuickAddModal">
        <div class="modal">
            <div class="modal-header">
                <div style="position: absolute; top: -50px; right: -50px; width: 150px; height: 150px; background: rgba(255,255,255,0.1); border-radius: 50%; animation: float 3s ease-in-out infinite;"></div>                
                <button class="modal-close" id="closeFabQuickAddModal">
                    <i class="fas fa-times"></i>
                </button>
                <div style="display: flex; align-items: center; justify-content: center; gap: 12px; margin-bottom: 8px;">
                    <div style="width: 48px; height: 48px; background: rgba(255,255,255,0.2); border-radius: 12px; display: flex; align-items: center; justify-content: center; backdrop-filter: blur(10px); box-shadow: 0 4px 12px rgba(0,0,0,0.1);">
                        <i class="fa fa-plus-square" style="font-size: 1.3rem; color: white;"></i>
                    </div>
                    <h2 class="modal-title" id="fabModalTitle" style="margin: 0; color: white;">Quick Add</h2>
                </div>
                <p class="modal-subtitle" id="fabModalSubtitle" style="display:none">Add new item</p>
            </div>
            <style>
            @keyframes float {
                0%, 100% { transform: translateY(0px) rotate(0deg); }
                50% { transform: translateY(-20px) rotate(180deg); }
            }
            </style>            
            <div class="modal-body">
                <form id="fabExpenseForm" class="fab-form" style="display: none;">
                    <div class="form-group" style="margin-bottom:0.8rem;">
                        <label for="fabExpenseDescription">What did you spend on?</label>
                        <input type="text" id="fabExpenseDescription" placeholder="e.g., Lunch, Gas" required>
                    </div>
                    <div class="form-row">
                        <div class="form-group" style="margin-bottom:0.8rem;">
                            <label for="fabExpenseAmount">Amount</label>
                            <div class="currency-input">
                                <span class="currency-symbol">Rp</span>
                                <input type="text" id="fabExpenseAmount" placeholder="0" required>
                            </div>
                        </div>
                        <div class="form-group" style="margin-bottom:0.8rem;">
                            <label for="fabExpenseDate">Date</label>
                            <input type="date" id="fabExpenseDate" required>
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label for="fabExpenseCategory">Category</label>
                            <select id="fabExpenseCategory" required>
                                <option value="">Select category</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="fabExpenseSubcategory">Subcategory</label>
                            <select id="fabExpenseSubcategory">
                                <option value="">Optional</option>
                            </select>
                        </div>
                    </div>
                    <div class="form-group">
                        <label for="fabReceiptUpload">Receipt (optional)</label>
                        <input type="file" 
                            id="fabReceiptUpload" 
                            accept="image/*,.pdf" 
                            style="padding: 10px 12px; font-size: 0.95rem; border: 2px dashed var(--light-gray); border-radius: 8px; cursor: pointer;">
                        <div class="form-hint" style="font-size: 0.75rem; color: var(--gray); margin-top: 4px;">
                            <i class="fas fa-info-circle"></i> Upload a photo of your receipt
                        </div>
                    </div>                    
                    <div class="form-group">
                        <label class="checkbox-label">
                            <input type="checkbox" id="fabExpenseIsReimbursable">
                            <span>ðŸ’° This expense will be reimbursed</span>
                        </label>
                    </div>                    
                    <button type="submit" class="btn btn-primary" style="width: 100%; padding: 12px;">
                        <i class="fas fa-plus"></i> Add Expense
                    </button>
                </form>

                <form id="fabIncomeForm" class="fab-form" style="display: none;">
                    <div class="form-group">
                        <label for="fabIncomeDescription">Source</label>
                        <input type="text" id="fabIncomeDescription" placeholder="e.g., Salary, Freelance" required>
                    </div>
                    
                    <div class="reimbursement-toggle">
                        <label>
                            <input type="checkbox" id="fabIncomeIsReimbursement">
                            <span>ðŸ”— This is a reimbursement</span>
                        </label>
                        <div class="toggle-hint">
                            Check this if you're being reimbursed for expenses you've already paid
                        </div>
                    </div>
                    
                    <div id="fabIncomeExpenseSelector" class="hidden" style="margin-bottom: 1rem;">
                        <button type="button" class="btn btn-outline" id="fabSelectExpensesBtn" style="width: 100%;">
                            <i class="fas fa-list-check"></i>
                            <span id="fabSelectedExpensesText">Select Expenses to Reimburse</span>
                        </button>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label for="fabIncomeAmount">Amount</label>
                            <div class="currency-input">
                                <span class="currency-symbol">Rp</span>
                                <input type="text" id="fabIncomeAmount" placeholder="0" required>
                            </div>
                        </div>
                        <div class="form-group">
                            <label for="fabIncomeDate">Date</label>
                            <input type="date" id="fabIncomeDate" required>
                        </div>
                    </div>
                    <div class="form-group">
                        <label for="fabIncomeSource">Type</label>
                        <select id="fabIncomeSource" required>
                            <option value="">Select type</option>
                            <option value="Salary">Salary</option>
                            <option value="Freelance">Freelance</option>
                            <option value="Investment">Investment</option>
                            <option value="Gift">Gift</option>
                            <option value="Bonus">Bonus</option>
                            <option value="Other">Other</option>
                        </select>
                    </div>
                    <button type="submit" class="btn btn-success" style="width: 100%; padding: 12px;">
                        <i class="fas fa-plus"></i> Add Income
                    </button>
                </form>

                <form id="fabWalletForm" class="fab-form" style="display: none;">
                    <div class="form-group">
                        <label for="fabWalletName">Wallet Name</label>
                        <input type="text" id="fabWalletName" placeholder="e.g., Cash, Bank Account" required>
                    </div>
                    <button type="submit" class="btn btn-primary" style="width: 100%; padding: 12px;">
                        <i class="fas fa-plus"></i> Add Wallet
                    </button>
                </form>

                <form id="fabCategoryForm" class="fab-form" style="display: none;">
                    <div class="form-group">
                        <label for="fabCategoryType">Type</label>
                        <select id="fabCategoryType" required>
                            <option value="">Select type</option>
                            <option value="main">Main Category</option>
                            <option value="sub">Subcategory</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="fabCategoryName">Name</label>
                        <input type="text" id="fabCategoryName" placeholder="e.g., Food, Transport" required>
                    </div>
                    <div class="form-group hidden" id="fabParentCategoryGroup">
                        <label for="fabParentCategory">Parent Category</label>
                        <select id="fabParentCategory">
                            <option value="">Select parent</option>
                        </select>
                    </div>
                    <button type="submit" class="btn btn-primary" style="width: 100%; padding: 12px;">
                        <i class="fas fa-plus"></i> Add Category
                    </button>
                </form>
            </div>
        </div>
    </div>  

    <div class="modal-overlay" id="editWalletModal">
        <div class="modal">
            <div class="modal-header" style="background: linear-gradient(135deg, #3B82F6 0%, #60A5FA 100%); position: relative; overflow: hidden;">
                <div style="position: absolute; top: -50px; right: -50px; width: 150px; height: 150px; background: rgba(255,255,255,0.1); border-radius: 50%; animation: float 3s ease-in-out infinite;"></div>
                <button class="modal-close" onclick="document.getElementById('editWalletModal').classList.remove('active')">
                    <i class="fas fa-times"></i>
                </button>
                <div style="display: flex; align-items: center; justify-content: center; gap: 12px; margin-bottom: 8px;">
                    <div style="width: 48px; height: 48px; background: rgba(255,255,255,0.2); border-radius: 12px; display: flex; align-items: center; justify-content: center; backdrop-filter: blur(10px); box-shadow: 0 4px 12px rgba(0,0,0,0.1);">
                        <i class="fas fa-wallet" style="font-size: 1.3rem; color: white;"></i>
                    </div>
                    <h2 class="modal-title" style="margin: 0; color: white;">Edit Wallet</h2>
                </div>
            </div>
            <div class="modal-body" style="padding: 1.25rem;">
                <form id="editWalletForm">
                    <input type="hidden" id="editWalletId">
                    
                    <div class="form-group" style="margin-bottom: 1rem;">
                        <label for="editWalletName" style="font-size: 0.85rem; margin-bottom: 0.3rem;">Wallet Name</label>
                        <input type="text" id="editWalletName" placeholder="e.g., Cash, Bank Account" required style="padding: 10px 12px; font-size: 0.95rem;">
                    </div>
                    
                    <div class="form-row" style="gap: 0.8rem; margin-top: 1rem;">
                        <button type="button" class="btn btn-outline" onclick="document.getElementById('editWalletModal').classList.remove('active')" style="padding: 10px; font-size: 0.9rem; flex: 1;">
                            <i class="fas fa-times"></i> Cancel
                        </button>
                        <button type="submit" class="btn btn-primary" style="padding: 10px; font-size: 0.9rem; flex: 1;">
                            <i class="fas fa-save"></i> Save
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <div class="modal-overlay" id="editCategoryModal">
        <div class="modal">
            <div class="modal-header" style="background: linear-gradient(135deg, #F59E0B 0%, #FBBF24 100%); position: relative; overflow: hidden;">
                <div style="position: absolute; top: -50px; right: -50px; width: 150px; height: 150px; background: rgba(255,255,255,0.1); border-radius: 50%; animation: float 3s ease-in-out infinite;"></div>
                <button class="modal-close" onclick="document.getElementById('editCategoryModal').classList.remove('active')">
                    <i class="fas fa-times"></i>
                </button>
                <div style="display: flex; align-items: center; justify-content: center; gap: 12px; margin-bottom: 8px;">
                    <div style="width: 48px; height: 48px; background: rgba(255,255,255,0.2); border-radius: 12px; display: flex; align-items: center; justify-content: center; backdrop-filter: blur(10px); box-shadow: 0 4px 12px rgba(0,0,0,0.1);">
                        <i class="fas fa-tags" style="font-size: 1.3rem; color: white;"></i>
                    </div>
                    <h2 class="modal-title" style="margin: 0; color: white;">Edit Category</h2>
                </div>
            </div>
            <div class="modal-body" style="padding: 1.25rem;">
                <form id="editCategoryForm">
                    <input type="hidden" id="editCategoryId">
                    
                    <div class="form-group" style="margin-bottom: 0.8rem;">
                        <label for="editCategoryType" style="font-size: 0.85rem; margin-bottom: 0.3rem;">Type</label>
                        <select id="editCategoryType" required style="padding: 10px 12px; font-size: 0.95rem;">
                            <option value="">Select type</option>
                            <option value="main">Main Category</option>
                            <option value="sub">Subcategory</option>
                        </select>
                    </div>
                    
                    <div class="form-group" style="margin-bottom: 0.8rem;">
                        <label for="editCategoryName" style="font-size: 0.85rem; margin-bottom: 0.3rem;">Name</label>
                        <input type="text" id="editCategoryName" placeholder="e.g., Food, Transport" required style="padding: 10px 12px; font-size: 0.95rem;">
                    </div>
                    
                    <div class="form-group hidden" id="editParentCategoryGroup" style="margin-bottom: 1rem;">
                        <label for="editParentCategory" style="font-size: 0.85rem; margin-bottom: 0.3rem;">Parent Category</label>
                        <select id="editParentCategory" style="padding: 10px 12px; font-size: 0.95rem;">
                            <option value="">Select parent</option>
                        </select>
                    </div>
                    
                    <div class="form-row" style="gap: 0.8rem; margin-top: 1rem;">
                        <button type="button" class="btn btn-outline" onclick="document.getElementById('editCategoryModal').classList.remove('active')" style="padding: 10px; font-size: 0.9rem; flex: 1;">
                            <i class="fas fa-times"></i> Cancel
                        </button>
                        <button type="submit" class="btn btn-primary" style="padding: 10px; font-size: 0.9rem; flex: 1;">
                            <i class="fas fa-save"></i> Save
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>  
    
    <div class="modal-overlay" id="budgetModal">
        <div class="modal">
            <div class="modal-header">    
                <div style="position: absolute; top: -50px; right: -50px; width: 150px; height: 150px; background: rgba(255,255,255,0.1); border-radius: 50%; animation: float 3s ease-in-out infinite;"></div>                
                <button class="modal-close" id="closeBudgetModal">
                    <i class="fas fa-times"></i>
                </button>
                <div style="display: flex; align-items: center; justify-content: center; gap: 12px; margin-bottom: 8px;">
                    <div style="width: 48px; height: 48px; background: rgba(255,255,255,0.2); border-radius: 12px; display: flex; align-items: center; justify-content: center; backdrop-filter: blur(10px); box-shadow: 0 4px 12px rgba(0,0,0,0.1);">
                        <i class="fa fa-plus-square" style="font-size: 1.3rem; color: white;"></i>
                    </div>
                    <h2 class="modal-title" style="color:white;">Set Category Budget</h2>
                </div>
            </div>
            <style>
            @keyframes float {
                0%, 100% { transform: translateY(0px) rotate(0deg); }
                50% { transform: translateY(-20px) rotate(180deg); }
            }
            </style>            
            <div class="modal-body">
                <form id="budgetForm">
                    <input type="hidden" id="budgetId">
                    
                    <div class="form-group">
                        <label for="budgetCategory">Category</label>
                        <select id="budgetCategory" required>
                            <option value="">Select category</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label for="budgetAmount">Monthly Limit</label>
                        <div class="currency-input">
                            <span class="currency-symbol">Rp</span>
                            <input type="text" id="budgetAmount" placeholder="0" required>
                        </div>
                    </div>
                    
                    <div style="display: flex; gap: 10px;">
                        <button type="button" class="btn btn-outline" onclick="document.getElementById('budgetModal').classList.remove('active')" style="flex: 1;">
                            <i class="fas fa-times"></i> Cancel
                        </button>
                        <button type="submit" class="btn btn-primary" style="flex: 1;">
                            <i class="fas fa-save"></i> Save Budget
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>    

    <div class="modal-overlay" id="budgetWarningModal">
        <div class="modal">
            <div class="modal-header" style="background: linear-gradient(135deg, #F59E0B 0%, #EF4444 100%);position: relative;overflow: hidden;justify-content: center;gap: 0.5rem;">
                <div style="position: absolute; top: -50px; right: -50px; width: 150px; height: 150px; background: rgba(255,255,255,0.1); border-radius: 50%; animation: float 3s ease-in-out infinite;"></div>
                <button class="modal-close" id="closeBudgetWarning">
                    <i class="fas fa-times"></i>
                </button>
                <div style="display: flex;align-items: center;justify-content: center;gap: 12px;/* margin-bottom: 8px; */">
                    <div style="width: 56px; height: 56px; background: rgba(255,255,255,0.25); border-radius: 16px; display: flex; align-items: center; justify-content: center; backdrop-filter: blur(10px); box-shadow: 0 4px 16px rgba(0,0,0,0.15);">
                        <i class="fas fa-exclamation-triangle" style="font-size: 1.8rem; color: white;"></i>
                    </div>
                </div>
                <h2 class="modal-title" style="margin: 0; color: white; font-size: 1.5rem;">Budget Exceeded!</h2>
                <!-- <p class="modal-subtitle" style="margin-top: 8px;">This expense will go over your spending limit</p> -->
            </div>
            
            <div class="modal-body" style="padding: 1.5rem;">
                <div style="text-align: center; margin-bottom: 1.5rem;">
                    <div style="display: inline-block; background: linear-gradient(135deg, #FEF3C7 0%, #FDE68A 100%); padding: 8px 16px; border-radius: 20px; border: 2px solid #F59E0B;">
                        <i class="fas fa-tag" style="color: #D97706; margin-right: 6px;"></i>
                        <span id="budgetWarningCategory" style="font-weight: 700; color: #92400E; font-size: 1rem;"></span>
                    </div>
                </div>
                
                <div style="background: linear-gradient(135deg, #FEF3C7 0%, #FDE68A 100%); border-radius: 16px; padding: 1.25rem; margin-bottom: 1.5rem; border: 2px solid #F59E0B;">
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 12px;">
                        <span style="color: #78350F; font-weight: 600; font-size: 0.9rem;">
                            <i class="fas fa-chart-line" style="margin-right: 6px;"></i>Budget Limit
                        </span>
                        <span id="budgetWarningBudget" style="font-weight: 700; color: #92400E; font-size: 1rem;"></span>
                    </div>
                    
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 12px;">
                        <span style="color: #78350F; font-weight: 600; font-size: 0.9rem;">
                            <i class="fas fa-minus-circle" style="margin-right: 6px;"></i>Already Spent
                        </span>
                        <span id="budgetWarningSpent" style="font-weight: 700; color: #D97706; font-size: 1rem;"></span>
                    </div>
                    
                    <div style="height: 1px; background: #F59E0B; margin: 12px 0; opacity: 0.3;"></div>
                    
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 12px;">
                        <span style="color: #78350F; font-weight: 600; font-size: 0.9rem;">
                            <i class="fas fa-plus-circle" style="margin-right: 6px;"></i>This Expense
                        </span>
                        <span id="budgetWarningNew" style="font-weight: 700; color: #DC2626; font-size: 1rem;"></span>
                    </div>
                    
                    <div style="height: 2px; background: linear-gradient(90deg, #F59E0B 0%, #EF4444 100%); margin: 12px 0;"></div>
                    
                    <div style="display: flex; justify-content: space-between; align-items: center;">
                        <span style="color: #78350F; font-weight: 700; font-size: 1rem;">
                            <i class="fas fa-equals" style="margin-right: 6px;"></i>Total After
                        </span>
                        <span id="budgetWarningTotal" style="font-weight: 800; color: #DC2626; font-size: 1.2rem;"></span>
                    </div>
                </div>
                
                <div style="background: linear-gradient(135deg, #FEE2E2 0%, #FECACA 100%); border-left: 4px solid #EF4444; padding: 1rem; border-radius: 12px; margin-bottom: 1.5rem;">
                    <div style="display: flex; align-items: flex-start; gap: 10px;">
                        <i class="fas fa-info-circle" style="color: #DC2626; margin-top: 2px; font-size: 1.1rem;"></i>
                        <div>
                            <p style="margin: 0; color: #7F1D1D; font-weight: 600; font-size: 0.95rem; line-height: 1.5;">
                                You'll be <span id="budgetWarningOver" style="font-weight: 800; color: #DC2626;"></span> over budget for this month.
                            </p>
                            <p style="margin: 6px 0 0 0; color: #991B1B; font-size: 0.85rem; line-height: 1.4;">
                                ðŸ’¡ <strong>Tip:</strong> Check the "ðŸ’° Reimbursable" box if this expense will be reimbursed!
                            </p>
                        </div>
                    </div>
                </div>
                
                <div style="display: flex; gap: 12px; margin-top: 1.5rem;">
                    <button class="btn btn-outline" id="cancelBudgetWarning" style="flex: 1; padding: 14px; font-size: 0.95rem;">
                        <i class="fas fa-times-circle"></i>
                        <span>Cancel</span>
                    </button>
                    <button class="btn" id="confirmBudgetWarning" style="flex: 1; padding: 14px; font-size: 0.95rem; background: linear-gradient(135deg, #F59E0B 0%, #EF4444 100%); color: white;">
                        <i class="fas fa-check-circle"></i>
                        <span>Add Anyway</span>
                    </button>
                </div>
            </div>
        </div>
    </div>

    <div class="modal-overlay" id="expenseSelectorModal">
        <div class="modal">
            <div class="modal-header">
                <div style="position: absolute; top: -50px; right: -50px; width: 150px; height: 150px; background: rgba(255,255,255,0.1); border-radius: 50%; animation: float 3s ease-in-out infinite;"></div>  
                <button class="modal-close" id="closeExpenseSelectorModal">
                    <i class="fas fa-times"></i>
                </button>
                <div style="display: flex; align-items: center; justify-content: center; gap: 12px; margin-bottom: 8px;">
                    <div style="width: 48px; height: 48px; background: rgba(255,255,255,0.2); border-radius: 12px; display: flex; align-items: center; justify-content: center; backdrop-filter: blur(10px); box-shadow: 0 4px 12px rgba(0,0,0,0.1);">
                        <i class="fas fa-link" style="font-size: 1.3rem; color: white;"></i>
                    </div>
                    <h2 class="modal-title" style="margin: 0; color: white;">Select Expenses to Reimburse</h2>
                </div>                 
                <!-- <h2 class="modal-title">Select Expenses to Reimburse</h2>
                <p class="modal-subtitle">Choose which expenses this income covers</p> -->
            </div>
            <div class="modal-body">
                <div class="expense-selector-list" id="expenseSelectorList">
                </div>
                
                <div class="expense-selector-summary" id="expenseSelectorSummary" style="display: none;">
                    <div class="summary-row">
                        <span class="summary-label">Selected Expenses:</span>
                        <span class="summary-value" id="selectedExpenseCount">0</span>
                    </div>
                    <div class="summary-row">
                        <span class="summary-label">Total Amount:</span>
                        <span class="summary-value" id="selectedExpenseTotal">Rp 0</span>
                    </div>
                </div>
                
                <div style="display: flex; gap: 10px; margin-top: 1rem;">
                    <button class="btn btn-outline" id="cancelExpenseSelector" style="flex: 1;">
                        <i class="fas fa-times"></i> Cancel
                    </button>
                    <button class="btn btn-primary" id="confirmExpenseSelector" style="flex: 1;">
                        <i class="fas fa-check"></i> Link Selected
                    </button>
                </div>
            </div>
        </div>
    </div>    

    <div class="modal-overlay" id="reimbursementDetailsModal">
        <div class="modal">
            <div class="modal-header" style="background: linear-gradient(135deg, #10B981 0%, #34D399 100%);">
                <button class="modal-close" id="closeReimbursementDetails">
                    <i class="fas fa-times"></i>
                </button>
                <h2 class="modal-title">Reimbursement Details</h2>
                <p class="modal-subtitle">Payment information</p>
            </div>
            <div class="modal-body">
                <div id="reimbursementDetailsContent">
                </div>
            </div>
        </div>
    </div>

    <div class="modal-overlay" id="unlinkReimbursementModal">
        <div class="modal">
            <div class="modal-header" style="background: linear-gradient(135deg, #EF4444 0%, #DC2626 100%);">
                <div style="position: absolute; top: -50px; right: -50px; width: 150px; height: 150px; background: rgba(255,255,255,0.1); border-radius: 50%; animation: float 3s ease-in-out infinite;"></div>                
                <button class="modal-close" id="closeUnlinkReimbursement">
                    <i class="fas fa-times"></i>
                </button>
                <div style="display: flex; align-items: center; justify-content: center; gap: 12px; margin-bottom: 8px;">
                    <div style="width: 48px; height: 48px; background: rgba(255,255,255,0.2); border-radius: 12px; display: flex; align-items: center; justify-content: center; backdrop-filter: blur(10px); box-shadow: 0 4px 12px rgba(0,0,0,0.1);">
                        <i class="fas fa-unlink" style="font-size: 1.3rem; color: white;"></i>
                    </div>
                    <h2 class="modal-title" style="color:white;">Unlink Reimbursement?</h2>
                </div>                
            </div>
            <div class="modal-body">
                <p id="unlinkReimbursementMessage" style="margin-bottom: 1.5rem; font-size: 0.95rem;">
                    Are you sure you want to unlink this reimbursement? The linked expenses will return to pending status.
                </p>
                <div style="display: flex; gap: 10px;">
                    <button class="btn btn-outline" id="cancelUnlinkReimbursement" style="flex: 1;">
                        <i class="fas fa-times"></i> Cancel
                    </button>
                    <button class="btn" id="confirmUnlinkReimbursement" style="flex: 1; background: #EF4444; color: white;">
                        <i class="fas fa-unlink"></i> Unlink
                    </button>
                </div>
            </div>
        </div>
    </div>    

    <div class="modal-overlay" id="exportModal">
        <div class="modal">
            <div class="modal-header" style="background: linear-gradient(135deg, #10B981 0%, #34D399 100%);">
                <button class="modal-close" id="closeExportModal">
                    <i class="fas fa-times"></i>
                </button>
                <h2 class="modal-title">
                    <i class="fas fa-download"></i> Export Data
                </h2>
                <p class="modal-subtitle">Download your financial data</p>
            </div>
            <div class="modal-body">
                <form id="exportForm">
                    <div class="form-group">
                        <label for="exportType">What to export</label>
                        <select id="exportType" required>
                            <option value="all">All Transactions</option>
                            <option value="expenses">Expenses Only</option>
                            <option value="income">Income Only</option>
                            <option value="summary">Summary Report</option>
                            <option value="budgets">Budgets</option>
                        </select>
                    </div>

                    <div class="form-group" id="dateRangeGroup">
                        <label for="exportDateRange">Time period</label>
                        <select id="exportDateRange" required>
                            <option value="this-month">This Month</option>
                            <option value="last-month">Last Month</option>
                            <option value="last-3-months">Last 3 Months</option>
                            <option value="last-6-months">Last 6 Months</option>
                            <option value="this-year">This Year</option>
                            <option value="last-year">Last Year</option>
                            <option value="all-time">All Time</option>
                            <option value="custom">Custom Range</option>
                        </select>
                    </div>

                    <div id="customDateRangeGroup" style="display: none;">
                        <div class="form-row" style="gap: 0.8rem;">
                            <div class="form-group" style="margin-bottom: 0;">
                                <label for="exportStartDate">From</label>
                                <input type="date" id="exportStartDate">
                            </div>
                            <div class="form-group" style="margin-bottom: 0;">
                                <label for="exportEndDate">To</label>
                                <input type="date" id="exportEndDate">
                            </div>
                        </div>
                    </div>

                    <div class="form-group">
                        <label for="exportFormat">Format</label>
                        <select id="exportFormat" required>
                            <option value="csv">CSV (Excel, Sheets)</option>
                        </select>
                    </div>

                    <button type="submit" class="btn btn-primary" style="width: 100%; padding: 12px; margin-top: 1rem;">
                        <i class="fas fa-download"></i> Download
                    </button>
                </form>

                <div style="margin-top: 1rem; padding: 1rem; background: var(--light-gray); border-radius: 8px; font-size: 0.85rem; color: var(--gray);">
                    <i class="fas fa-info-circle"></i> 
                    CSV files open in Excel, Google Sheets, and Numbers. Your data stays privateâ€”everything is processed in your browser.
                </div>
            </div>
        </div>
    </div>    

    <div class="modal-overlay" id="receiptViewerModal">
        <div class="modal" style="max-width: 90vw; max-height: 90vh;">
            <div class="modal-header" style="background: linear-gradient(135deg, #6366F1 0%, #8B5CF6 100%);">
                <button class="modal-close" id="closeReceiptViewer">
                    <i class="fas fa-times"></i>
                </button>
                <h2 class="modal-title">Receipt</h2>
                <p class="modal-subtitle" id="receiptExpenseName">Expense details</p>
            </div>
            <div class="modal-body" style="padding: 0; overflow: auto; max-height: calc(90vh - 100px);">
                <div id="receiptViewerContent" style="display: flex; align-items: center; justify-content: center; min-height: 400px;">
                </div>
            </div>
            <div style="padding: 1rem; border-top: 1px solid var(--light-gray); display: flex; gap: 10px; justify-content: flex-end;">
                <a id="receiptDownloadBtn" href="#" download class="btn btn-outline" target="_blank">
                    <i class="fas fa-download"></i> Download
                </a>
                <button class="btn btn-primary" onclick="document.getElementById('receiptViewerModal').classList.remove('active')">
                    <i class="fas fa-check"></i> Close
                </button>
            </div>
        </div>
    </div>    

    <div id="searchModal" class="modal-overlay">
        <div class="modal-content">
            <div class="modal-header">
                <div style="position: absolute; top: -50px; right: -50px; width: 150px; height: 150px; background: rgba(255,255,255,0.1); border-radius: 50%; animation: float 3s ease-in-out infinite;"></div>        
                <button class="modal-close" id="closeSearchModal">
                    <i class="fas fa-times"></i>
                </button>                      
                <div style="display: flex; align-items: center; justify-content: center; gap: 12px; margin-bottom: 8px;">
                    <div style="width: 48px; height: 48px; background: rgba(255,255,255,0.2); border-radius: 12px; display: flex; align-items: center; justify-content: center; backdrop-filter: blur(10px); box-shadow: 0 4px 12px rgba(0,0,0,0.1);">
                        <i class="fas fa-search" style="font-size: 1.3rem; color: white;"></i>
                    </div>
                    <h2 class="modal-title" style="color:white";>Search Transactions</h2>
                </div>                    

            </div>
            
            <div class="modal-body">
                <div class="form-group">
                    <label>
                        <i class="fas fa-search"></i>
                        Search Term
                    </label>
                    <input type="text" 
                        id="searchInput" 
                        placeholder="Enter description to search..."
                        autocomplete="off">
                </div>

                <div class="form-group">
                    <label>
                        <i class="fas fa-filter"></i>
                        Transaction Type
                    </label>
                    <select id="searchType">
                        <option value="all">All Transactions</option>
                        <option value="expenses">Expenses Only</option>
                        <option value="income">Income Only</option>
                    </select>
                </div>

                <div class="form-group">
                    <label>
                        <i class="fas fa-calendar"></i>
                        Date Range
                    </label>
                    <select id="searchDateRange">
                        <option value="all-time">All Time</option>
                        <option value="this-month">This Month</option>
                        <option value="last-month">Last Month</option>
                        <option value="this-year">This Year</option>
                        <option value="last-year">Last Year</option>
                        <option value="custom">Custom Range</option>
                    </select>
                </div>

                <div id="searchCustomDateRange" style="display: none;">
                    <div class="form-row">
                        <div class="form-group">
                            <label>Start Date</label>
                            <input type="date" id="searchStartDate">
                        </div>
                        <div class="form-group">
                            <label>End Date</label>
                            <input type="date" id="searchEndDate">
                        </div>
                    </div>
                </div>

                <button id="executeSearchBtn" class="btn btn-primary" style="width: 100%; margin-top: 1rem;">
                    <i class="fas fa-search"></i> Search
                </button>

                <div id="searchResultsCount" style="display: none; margin-top: 1rem; padding: 0.75rem; background: var(--light-gray); border-radius: 8px; text-align: center; font-weight: 600;">
                    <i class="fas fa-info-circle"></i>
                    <span id="searchResultsText">0 results found</span>
                </div>

                <div id="searchResults" style="margin-top: 1.5rem;">
                </div>
            </div>
        </div>
    </div>    

    <script type="module">

        async function initApp() {
            try {
                 const response = await fetch('/api/config');
                 if (!response.ok) {
                     throw new Error('Failed to fetch config');
                 }
                
                 const config = await response.json();

                const supabase = window.supabase.createClient(
                     config.supabaseUrl,
                     config.supabaseAnonKey
                    // SUPABASE_URL, 
                    // SUPABASE_ANON_KEY                    
                );
                
                const { createApp } = await import('./js/app.js');            
                
                const app = createApp(supabase);
                await app.init();
                
                window.finTrack = {
                    app,
                    ui: app.ui,
                    state: app.state,
                    auth: app.auth,
                    db: app.db
                };
                
                window.finTrack.pendingDelete = null;

                window.finTrack.debug = {
                    getState: () => window.finTrack.state.getState(),
                    getExpenses: () => window.finTrack.state.getExpenses(),
                    getIncomes: () => window.finTrack.state.getIncomes(),
                    getWallets: () => window.finTrack.state.getWallets(),
                    getCategories: () => window.finTrack.state.getCategories()
                };                
                
                
            } catch (error) {
                
                const alertContainer = document.getElementById('alertContainer');
                if (alertContainer) {
                    const alert = document.createElement('div');
                    alert.className = 'alert alert-error';
                    alert.innerHTML = `<i class="fas fa-exclamation-circle"></i> Failed to load application. Please refresh. Error: ${error.message}`;
                    alertContainer.appendChild(alert);
                }
            }
        }

        if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', initApp);
        } else {
            initApp();
        }

        document.addEventListener('DOMContentLoaded', function() {
            document.addEventListener('click', function(e) {
                if (e.target.classList.contains('modal-overlay')) {
                    e.target.classList.remove('active');
                }
            });
            
            document.addEventListener('keydown', function(e) {
                if (e.key === 'Escape') {
                    document.querySelectorAll('.modal-overlay.active').forEach(modal => {
                        modal.classList.remove('active');
                    });
                }
            });
            
            window.editExpense = function(id) {
                if (window.finTrack && window.finTrack.ui) {
                    window.finTrack.ui.editExpense(id);
                }
            };
            
            window.editIncome = function(id) {
                if (window.finTrack && window.finTrack.ui) {
                    window.finTrack.ui.editIncome(id);
                }
            };
            
            window.editWallet = function(id) {
                if (window.finTrack && window.finTrack.ui) {
                    window.finTrack.ui.editWallet(id);
                }
            };
            
            window.editCategory = function(id) {
                if (window.finTrack && window.finTrack.ui) {
                    window.finTrack.ui.editCategory(id);
                }
            };
            
            window.openBudgetModal = function() {
                if (window.finTrack && window.finTrack.ui) {
                    window.finTrack.ui.openBudgetModal();
                }
            };

            window.toggleRecentActivity = function() {
                const container = document.getElementById('recentActivityContainer');
                const chevron = document.getElementById('recentActivityChevron');
                
                if (container.style.display === 'none') {
                    container.style.display = 'block';
                    chevron.style.transform = 'rotate(180deg)';
                } else {
                    container.style.display = 'none';
                    chevron.style.transform = 'rotate(0deg)';
                }
            };
            
            document.getElementById('closeReimbursementDetails')?.addEventListener('click', () => {
                document.getElementById('reimbursementDetailsModal').classList.remove('active');
            });

            document.getElementById('closeUnlinkReimbursement')?.addEventListener('click', () => {
                document.getElementById('unlinkReimbursementModal').classList.remove('active');
                window.finTrack.pendingUnlinkIncomeId = null;
            });

            document.getElementById('cancelUnlinkReimbursement')?.addEventListener('click', () => {
                document.getElementById('unlinkReimbursementModal').classList.remove('active');
                window.finTrack.pendingUnlinkIncomeId = null;
            });

            document.getElementById('confirmUnlinkReimbursement')?.addEventListener('click', () => {
                if (window.finTrack && window.finTrack.app) {
                    window.finTrack.app.confirmUnlinkReimbursement();
                }
            });            

        });  

        window.toggleSettingsSection = function(section) {
            const body = document.getElementById(`${section}Body`);
            const chevron = document.getElementById(`${section}Chevron`);
            
            if (!body || !chevron) return;
            
            const isExpanded = body.style.display === 'block';
            
            if (isExpanded) {
                body.style.display = 'none';
                chevron.style.transform = 'rotate(0deg)';
            } else {
                body.style.display = 'block';
                chevron.style.transform = 'rotate(180deg)';
            }
        };        
    </script>

</body>

</html>
